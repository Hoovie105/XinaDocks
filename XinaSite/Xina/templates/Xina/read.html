{% extends 'Xina/main.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'Xina/css/Style5.css' %}">
<div class="doc-footer">
  <a href="{% url 'xina:main' %}" class="back-link">Â« Back to Documents</a>
</div>
<div class="doc-container">
  <div class="doc-header">
    <h1 class="doc-title">{{ doc.title }}</h1>
    <div class="doc-meta">
      <p><strong>Created by:</strong> {{ doc.created_by.username }}</p>
      <p><strong>Created on:</strong> {{ doc.created_at|date:"M d, Y" }}</p>
    </div>
  </div>

  <hr class="doc-divider">

  <div class="doc-content">
    <p>{{ doc.content }}</p>
  </div>

  {% if attachments %}
  <div class="doc-attachments">
    <h3>Attachments</h3>
    <div class="attachment-list">
      {% for file in attachments %}
        <div class="attachment-item">
          {% if file.is_pdf %}
            <object data="{{ file.file.url }}" type="application/pdf" width="100%" height="500px" class="attachment-preview">
              <p>
                <a href="{{ file.file.url }}" target="_blank">{{ file.file.name }}</a>
              </p>
            </object>
          {% elif file.is_image %}
            <img src="{{ file.file.url }}" alt="attachment" class="attachment-image">
          {% else %}
            <a href="{{ file.file.url }}" target="_blank" class="attachment-link">{{ file.file.name }}</a>
          {% endif %}

          {% if can_manage %}
          <form method="POST" action="{% url 'xina:delete_attachment' file.id %}" class="delete-form">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Remove Attachment</button>
          </form>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  {% if can_manage %}
  <div class="doc-actions">
    <form method="POST" action="{% url 'xina:delete' doc.id %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-delete">Delete Document</button>
    </form>

    <form method="POST" action="{% url 'xina:update' doc.id %}">
      {% csrf_token %}
      <button type="submit" class="btn btn-edit">Update Document</button>
    </form>
  </div>
  {% endif %}
</div>
{% endblock %}
